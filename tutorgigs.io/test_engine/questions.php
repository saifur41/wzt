<?php    //header   require_once 'includes/header.php';   if ( empty($_GET['testID']) ) { 			$_GET['testID'] = $_SESSION['qTestID'];			}				$questionList = mysqli_query($connection, "SELECT * from questions WHERE TestID=".$_GET['testID']);		$totalQuestions = $questionList->num_rows;				$questionTypes = mysqli_query($connection, "SELECT * FROM questionTypes");										$result = mysqli_query($connection, "SELECT Name FROM tests WHERE ID=".$_GET['testID']." LIMIT 1");		$testRow = mysqli_fetch_array($result);		$testName = $testRow['Name'];		$testID =  $_GET['testID'];				$answerLetter = array("A", "B", "C", "D", "E");  ?>					<!--begin::Content-->					<div class="content d-flex flex-column flex-column-fluid" id="kt_content">						<!--begin::Subheader-->						<div class="subheader py-2 py-lg-6 subheader-transparent" id="kt_subheader">							<div class="container d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">								<!--begin::Info-->																<!--end::Info-->								<!--begin::Toolbar-->																<!--end::Toolbar-->							</div>						</div>						<!--end::Subheader-->						<!--begin::Entry-->						<div class="d-flex flex-column-fluid">							<!--begin::Container-->							<div class="container">								<!--begin::Notice-->                                                                								<!--begin::Card-->                                                                <div class="card card-custom" style="margin-bottom:20px">									<div class="card-header flex-wrap py-5">										<div class="card-title">											<h3 class="card-label"><strong><? echo $testName ?></strong> Questions											<div class="text-muted pt-2 font-size-sm">Total <? echo $totalQuestions ?> questions</div></h3>										</div>										<div class="card-toolbar">																						<!--end::Dropdown-->											<!--begin::Button-->											<button data-toggle="modal" data-target="#myModal" class="btn btn-primary font-weight-bolder">                                                                                            <i class="la la-plus-circle" style="font-size: 20px"></i>New Question</button>											<!--end::Button-->										</div>									</div>									<div class="card-body">                                                                            										<!--begin: Datatable-->										<div class="box-group" id="accordion">                                        <!-- we are adding the .panel class so bootstrap.js collapse plugin detects it -->                                                                                 <?php													$qCount = 1;                                                while ( $qRecord = mysqli_fetch_array($questionList) ) {													// row color                                                    $rowColor = (string)$qRecord['IsActive'] == 1 ? 'success' : 'danger';													                                        ?>                                                                                <div class="panel box box-<? echo $rowColor?>" style="margin-bottom:5% !important">                                            <div class="box-header">                                                <div class="col-md-12 pull-right">                                                    <div class="card-toolbar">                                                    																										<a style="float:right" href="javascript:void()" onclick="deleteQuestion(<? echo $qRecord['ID'] ?>);" class="btn btn-icon btn-sm btn-warning" data-card-tool="remove" data-toggle="tooltip" data-placement="top" title="" data-original-title="Remove Card">														<i class="la la-remove"></i>													</a>                                                            <a style="float:right" href="javascript:void()"  onClick="qePopulate( <? echo $qRecord['ID'] ?>);"  title="Edit this Question" class="btn btn-icon btn-sm btn-primary mr-1" data-card-tool="toggle" data-toggle="tooltip" data-placement="top" title="" data-original-title="Toggle Card">														<i class="la la-edit"></i>													</a>												</div>                                                </div>                                                <h3 class="box-title text-warning" id="t<?php echo $qRecord['ID'] ?>"><strong>Question <?php echo $qCount++ ?>.</strong>      </h3>                                                                                                                                                            <a data-toggle="collapse" data-parent="#accordion" href="#collapse<?php echo $qRecord['ID'] ?>" class="collapsed">                                                                                                                                                               <div id="theQ<?php echo $qRecord['ID'] ?>">   <?php echo $qRecord['Question'] ?></div>                                                    </a>                                                                                                                                                                                                                                                    </div>                                            <div id="collapse<?php echo $qRecord['ID'] ?>" class="panel-collapse collapse" style="height: 0px;">                                                <div class="box-body">                                                                        <div class="card card-custom">											<div class="card-header">												<div class="card-title">													<h3 class="card-label">Question Answers																									</div>											</div>											<div class="card-body">                                                                                            <table class="table">    <thead>        <tr>            <th scope="col">#</th>             <th scope="col"></th>            <th scope="col">Answer</th>            <th scope="col">Action</th>             </tr>    </thead>    <tbody>         <?php 														$options = explode(",", $qRecord['OptionIDs']);														$correctLetter = '';														$correctAnswer = '';																												// Looop through Options														for ($j=0; $j < count($options); $j++ ) {															$query = "SELECT * FROM answers WHERE ID=".$options[$j];															$result = mysqli_query($connection, $query);																														$qOption = mysqli_fetch_array($result);															// Find Correct Answeer															if ($options[$j] == $qRecord['AnswerID']) {																$correctLetter = $answerLetter[$j];																$correctAnswer = $qOption['Answer'];															} 															// Begin table row of Answer Options/Choices															echo '<tr style="text-align:bottom;">';                                                                                                                        echo '<td>';                                                                                                                        echo ' <strong>'.$answerLetter[$j].'.</strong>&nbsp;&nbsp;';                                                                                                                        echo '</td>';																// Radio Button															echo '<td>';																																														echo '<label class="radio"><input type="radio"  name="answer'.$qCount.'" value="'.$options[$j].'"><span></span></label>';																															echo '</td>';																// The Answer Choice																													echo '<td>';																echo '<span id="theO'.$qOption['ID'].'">'. $qOption['Answer'] . '</span>';                                                                                                                             echo '</td>';																echo '<td>                                                                                                                                     <button id="newFeature" 																	data-toggle="tooltip" 																	data-placement="left"																	data-content="Edit this Answer option" 																	data-original-title="P2G Admin"																	data-trigger"hover"																	type="button"  class="btn btn-icon btn-sm btn-default mr-1" title="Edit Answer Option" onClick="oePopulate( ' . $qOption['ID'] . ');"><i class="la la-edit"></i></button>																																';															echo '</td>';																														echo '</tr>';																													}																												// Print Answer - after loop through options														echo '<tr><td colspan="3">';															echo '<h4>The Correct Answer is '.$correctLetter.'. '.$correctAnswer.'</h4>';																														echo '</td</tr>';																																																							?>                    </tbody></table>                                                                                            </div>										</div>                                                                                	                                                                                                       <br>                                                                                                    </div>                                            </div>                                        </div>                                         <hr>                                                <?php } ?>                                                                                                                                                                										<!--end: Datatable-->									</div>								</div>								<!--end::Card-->							</div>							<!--end::Container-->						</div>						<!--end::Entry-->					</div>                                                                                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalSizeDefault" aria-hidden="true">				             <div class="modal-dialog modal-dialog-centered modal-lg" role="document">						<div class="modal-content">                                                      <form id="qForm" name="qForm" role="form" action="<?php echo BASE_URL;?>addQuestion.php" method="post">                                                                                                                                         <div class="modal-header">						  <h5 class="modal-title" id="exampleModalLabel">New Question</h5>						   <button type="button" class="close" data-dismiss="modal" aria-label="Close">						      <i aria-hidden="true" class="ki ki-close"></i>						  </button>						</div>                    <div class="modal-body">                                        	                                                                                           <!-- Text input-->                                <div class="control-group">                                  <label class="control-label" for="qQuestion">Question</label>                                  <div class="controls">                                 	 <textarea  id="qQuestion" name="qQuestion">                                            This is my Question to be replaced with CKEditor.                                     </textarea>                                    <!--<input id="qQuestion" name="qQuestion" type="text" placeholder="Enter the Question here" class="form-control" required>-->                                  </div>                                </div>                                <br/>                                     <!-- Multiple Radios -->                                <div class="control-group">                                  <label class="control-label" for="qQuestionType">Question Type</label>                                  <div class="controls">                                  <select class="form-control" id="qQuestionType" name="qQuestionType" onBlur="checkType()" onChange="checkType()">                                  	<?php while ($type = mysqli_fetch_array($questionTypes)) { ?>                                    <option value="<? echo $type['ID']?>"><? echo $type['Name'] ?></option>                                     											<?php } ?>                                         </select>                                                                      </div>                                                                                                 </div>                                  <br/>                                <!-- Text input-->                                <div id="qNumOptionsGroup" class="control-group">                                  <label class="control-label" for="qNumOptions">Number of Choices/Options</label>                                  <div class="controls">                                    <select class="form-control" id="qNumOptions" name="qNumOptions" autofocus onBlur="checkOptions()" onChange="checkOptions()">                                        <option value="0" selected>[Select the Number of Options]</option>                                        <option value="1">1 Option</option>                                        <option value="2">2 Options</option>                                        <option value="3">3 Options</option>                                        <option value="4">4 Options</option>                                        <option value="5">5 Options</option>                                     </select>                                                                      </div>                                                                 </div>                                <br/>                                <div id="qOptionList" class="control-group">                                </div>                                <br/>                                <div id="qAnswer" class="control-group">                                </div>                                <br/>                                       <!-- Multiple Radios -->                                <div class="control-group">                                  <label class="control-label" for="qIsActive">Shown in Test</label>                                                                      <div class="radio-inline">															<label class="radio">															<input type="radio" name="qIsActive" id="qIsActive-0" value="1" checked="checked">															<span></span>Active</label>															<label class="radio">															<input type="radio" name="qIsActive" id="qIsActive-1" value="0">															<span></span>Not Active</label>																													</div>                                                                  </div>                                <input type="hidden" id="qCreator" name="qCreator" value="<?php echo $_SESSION['user']['id']; ?>">                                <input type="hidden" id="qTestID" name="qTestID" value="<?php echo $testID; ?>">                                <!-- Button (Double) -->                                                                                                                                                           </div>                                         <div class="modal-footer">						<button type="button" class="btn btn-light-primary font-weight-bold" data-dismiss="modal">Close</button>						<button type="submit" class="btn btn-primary font-weight-bold">Submit</button>					       </div> </form>                </div>                <!-- /.modal-content -->            </div>            <!-- /.modal-dialog -->        </div>                                                                <div class="modal fade" id="myEditQuestionModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalSizeDefault" aria-hidden="true">				             <div class="modal-dialog modal-dialog-centered modal-lg" role="document">						<div class="modal-content">                                                    <form id="qeForm" name="qeForm" role="form" action="<?php echo BASE_URL;?>editQuestion.php" method="post">                                                                            <div class="modal-header">						  <h5 class="modal-title" id="exampleModalLabel">Edit Question for <strong><? echo $testName; ?></h5>						   <button type="button" class="close" data-dismiss="modal" aria-label="Close">						      <i aria-hidden="true" class="ki ki-close"></i>						  </button>						</div>                    <div class="modal-body">                                        	                                                             <script type="text/javascript">							   							   </script>                                <!-- Text input-->                                <div class="control-group">                                  <label class="control-label" for="qeQuestion">Question</label>                                  <div class="controls">                                 	 <textarea class="qeEditor" id="qeQuestion" name="qeQuestion" rows="20" style="width:100%"></textarea>                                    <!--<input id="qQuestion" name="qQuestion" type="text" placeholder="Enter the Question here" class="form-control" required>-->                                  </div>                                </div>                                <br/>                                                                    <input type="hidden" id="qeCreator" name="qeCreator" value="<?php echo $_SESSION['user']['id']; ?>">                                <input type="hidden" id="qeTestID" name="qeTestID" value="<?php echo $testID; ?>">                                 <input type="hidden" id="qeID" name="qeID" value="">                                                                                                                              </div>                                        <div class="modal-footer">						<button type="button" class="btn btn-light-primary font-weight-bold" data-dismiss="modal">Close</button>						<button type="submit" class="btn btn-primary font-weight-bold">Submit</button>					       </div>                  </form>                </div>                <!-- /.modal-content -->            </div>            <!-- /.modal-dialog -->        </div>        <!-- /.modal -->                                                                            <div class="modal fade" id="myEditOptionModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalSizeDefault" aria-hidden="true">				             <div class="modal-dialog modal-dialog-centered " role="document">						<div class="modal-content">                                                     <form id="oeForm" name="oeForm" role="form" action="<?php echo BASE_URL;?>editOption.php" method="post">                                              <div class="modal-header">						  <h5 class="modal-title" id="exampleModalLabel">Edit Answer Option for <strong><? echo $testName; ?></h5>						   <button type="button" class="close" data-dismiss="modal" aria-label="Close">						      <i aria-hidden="true" class="ki ki-close"></i>						  </button>						</div>                    <div class="modal-body">                                                                                                <script type="text/javascript">							   							   </script>                                <!-- Text input-->                                <div class="control-group">                                  <label class="control-label" for="oeOption">Option</label>                                  <div class="controls">                                 	 <textarea class="oeOption" id="oeOption" name="oeOption" rows="10" style="width:100%"></textarea>                                    <!--<input id="qQuestion" name="qQuestion" type="text" placeholder="Enter the Question here" class="form-control" required>-->                                  </div>                                </div>                                <br/>                                                                    <input type="hidden" id="oeCreator" name="oeCreator" value="<?php echo $_SESSION['user']['id']; ?>">                                <input type="hidden" id="oeTestID" name="oeTestID" value="<?php echo $testID; ?>">                                 <input type="hidden" id="oeID" name="oeID" value="">                                <!-- Button (Double) -->                                                                                                                                                           </div>                                        <div class="modal-footer">						<button type="button" class="btn btn-light-primary font-weight-bold" data-dismiss="modal">Close</button>						<button type="submit" class="btn btn-primary font-weight-bold">Submit</button>					       </div>                                                          </form>                </div>                <!-- /.modal-content -->            </div>            <!-- /.modal-dialog -->        </div>        <!-- /.modal -->					<!--end::Content--><?php    //header   require_once 'includes/footer.php';   ?><script src="<?php echo BASE_URL;?>assets/plugins/custom/ckeditor/ckeditor-classic.bundle.js"></script>		<!--end::Page Vendors-->		<!--begin::Page Scripts(used by this page)-->		 <script src="<?php echo BASE_URL;?>js/ckeditor/ckeditor.js" type="text/javascript"></script>        <script type="text/javascript" src="<?php echo BASE_URL;?>js/ckeditor/adapters/jquery.js"></script>               <script type="text/javascript">							   function checkOptions() {								   //alert( $("#tSubjectID").val() > 0 );									if ( $("#qNumOptions").val() > 0) {										$("#qSubmit").removeAttr("disabled"); 																				// Iterate Options inputs										var optionInputs = '';																				for (j = 0; j < $("#qNumOptions").val(); j++) {											optionInputs+= '<label class="control-label" for="qOption'+(j+1)+'">Option '+ (j+1) + '</label>';											optionInputs+= '<div class="controls">';											//optionInputs+= '<input id="qOption'+(j+1)+'" name="qOption'+(j+1)+'" type="text" ';											optionInputs+= '<textarea id="qOption'+(j+1)+'" name="qOption'+(j+1)+'" type="text" ';																						//optionInputs+=	'placeholder="" ';											//optionInputs+=	'class="form-control" required>';											optionInputs+=	'class="form-control" required> </textarea>';																										optionInputs+= '</div><br/>';										}																				// Populate div with inputs										$("#qOptionList").html( optionInputs ) ;										$("#qOptionList").show();																				// CKEditor replace those inputs//										for (j = 0; j < $("#qNumOptions").val(); j++) {											//											CKEDITOR.replace('qOption' + (j+1),{} );//											//CKEDITOR.add;		//										}																				// Iterate Correct Answer list										var correctAnswer = '';											correctAnswer+='<label class="control-label" for="qCorrectAnswer">Correct Answer</label>';											correctAnswer+= '<select class="form-control" id="qCorrectAnswer" name="qCorrectAnswer" onBlur="alert( $("#qCorrectAnswer").val() )">';										for (k = 0; k < $("#qNumOptions").val(); k++) {											correctAnswer+= '<option value="'+(k+1)+'">Option'+(k+1)+'</option>';											}											correctAnswer+= '</select>';																					$("#qAnswer").html( correctAnswer ) ;										$("#qAnswer").show();																													} else {										$("#qSubmit").attr("disabled", "disabled");										$("#qOptionList").hide();										$("#qOptionList").html( '' ) ;																				$("#qAnswer").hide();										$("#qAnswer").html( '' ) ;									}								}								function checkType() {									// if multiple choice																		if ( $("#qQuestionType").val() == '1' ) {										$("#qNumOptionsGroup").show();										$("#qNumOptionsGroup").val(0);										checkOptions();										$("#qOptionList").show();																				$("#qSubmit").attr("disabled", "disabled");									}  									// true or false									if ( $("#qQuestionType").val() == '2' ) {										//alert($("#qTestType").val());										$("#qNumOptionsGroup").hide();										$("#qOptionList").hide();										$("#qOptionList").html( '' ) ;										$("#qAnswer").hide();										$("#qAnswer").html( '' ) ;										$("#qSubmit").removeAttr("disabled");																				// Iterate Correct Answer list										var correctAnswer = '';											correctAnswer+='<label class="control-label" for="qCorrectAnswer">Correct Answer</label>';											correctAnswer+= '<select class="form-control" id="qCorrectAnswer" name="qCorrectAnswer">';																					correctAnswer+= '<option value="1">True</option>';												correctAnswer+= '<option value="2">False</option>';																					correctAnswer+= '</select>';																					$("#qAnswer").html( correctAnswer ) ;										$("#qAnswer").show();									}  									// yes or no									if ( $("#qQuestionType").val() == '3' ) {										//alert($("#qTestType").val());										$("#qNumOptionsGroup").hide();										$("#qOptionList").hide();										$("#qOptionList").html( '' ) ;										$("#qAnswer").hide();										$("#qAnswer").html( '' ) ;										$("#qSubmit").removeAttr("disabled");																				// Iterate Correct Answer list										var correctAnswer = '';											correctAnswer+='<label class="control-label" for="qCorrectAnswer">Correct Answer</label>';											correctAnswer+= '<select class="form-control" id="qCorrectAnswer" name="qCorrectAnswer">';																					correctAnswer+= '<option value="1">Yes</option>';												correctAnswer+= '<option value="2">No</option>';																					correctAnswer+= '</select>';																					$("#qAnswer").html( correctAnswer ) ;										$("#qAnswer").show();									}																	}							   </script> <script type="text/javascript">        				        function deleteTest ( testID ) {            window.location = "<?php echo BASE_URL;?>tests.php?action=deleteTest&testID=" + testID ;        }                function toggleTestActive( testID ) {            window.location = "<?php echo BASE_URL;?>tests.php?action=toggleTest&testID=" + testID ;        }                function editTest(test_id)        {                      $.ajax({            type: 'GET',            url: "<?php echo BASE_URL;?>/getTest.php?test_id="+test_id, // a public, HTTP POST sandbox that returns the POST data            success: function(data) {              $('#test_body').html(data);                $('#editTest').modal('show');            }          });        }        </script>                <script type="text/javascript">        $(document).on('focusin', function(e) {			if ($(event.target).closest("#myModal").length) {				e.stopImmediatePropagation();			}		});				$(function() {                // Replace the <textarea id="editor1"> with a CKEditor                // instance, using default configuration.                CKEDITOR.replace('qQuestion');				CKEDITOR.replace('qeQuestion');				CKEDITOR.replace('oeOption');                				//bootstrap WYSIHTML5 - text editor                //$(".textarea").wysihtml5();            });		        function deleteQuestion ( questionID ) {            window.location = "<?php echo BASE_URL;?>delQuestion.php?tID=<?php echo $_REQUEST['testID']?>&qID=" + questionID ;        }                function toggleQuestionActive( questionID ) {            window.location = "adminfQuestions.php?action=toggleQuestion&questionID=" + questionID ;        }				$.widget( "ui.dialog", $.ui.dialog, {		 /*! jQuery UI - v1.10.2 - 2013-12-12		  *  http://bugs.jqueryui.com/ticket/9087#comment:27 - bugfix		  *  http://bugs.jqueryui.com/ticket/4727#comment:23 - bugfix		  *  allowInteraction fix to accommodate windowed editors		  */		  _allowInteraction: function( event ) {			if ( this._super( event ) ) {			  return true;			}					// address interaction issues with general iframes with the dialog			if ( event.target.ownerDocument != this.document[ 0 ] ) {			  return true;			}					// address interaction issues with dialog window			if ( $( event.target ).closest( ".cke_dialog" ).length ) {			  return true;			}					// address interaction issues with iframe based drop downs in IE			if ( $( event.target ).closest( ".cke" ).length ) {			  return true;			}		  },		 /*! jQuery UI - v1.10.2 - 2013-10-28		  *  http://dev.ckeditor.com/ticket/10269 - bugfix		  *  moveToTop fix to accommodate windowed editors		  */		  _moveToTop: function ( event, silent ) {			if ( !event || !this.options.modal ) {			  this._super( event, silent );			}		  }		});						$('#myEditQuestionModal').on('shown.bs.modal', function () {			//alert('hi');					});				// Question Edit populate form		function qePopulate( qid) {				//alert($('#theQ'+qid).html());							CKEDITOR.instances.qeQuestion.setData($('#theQ'+qid).html());			$('#qeID').val(qid);						$('#myEditQuestionModal').modal('toggle');								}		// Option/Answer Edit populate form		function oePopulate( aid) {	            			//alert($('#theQ'+aid).html());				CKEDITOR.instances.oeOption.focus();			CKEDITOR.instances.oeOption.setData($('#theO'+aid).html());                        			$('#oeID').val(aid);						$('#myEditOptionModal').modal('toggle');								}				        </script>                                        